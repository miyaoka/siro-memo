<template>
  <div
    class="ytpContainer"
    :style="thumbStyle"
    @click="isPlay = true"
    >
    <button v-if="!isPlay" class="ytp-large-play-button ytp-button" aria-label="再生">
      <svg height="100%" version="1.1" viewBox="0 0 68 48" width="100%">
        <path class="ytp-large-play-button-bg" d="M66.52,7.74c-0.78-2.93-2.49-5.41-5.42-6.19C55.79,.13,34,0,34,0S12.21,.13,6.9,1.55 C3.97,2.33,2.27,4.81,1.48,7.74C0.06,13.05,0,24,0,24s0.06,10.95,1.48,16.26c0.78,2.93,2.49,5.41,5.42,6.19 C12.21,47.87,34,48,34,48s21.79-0.13,27.1-1.55c2.93-0.78,4.64-3.26,5.42-6.19C67.94,34.95,68,24,68,24S67.94,13.05,66.52,7.74z" fill="#212121" fill-opacity="0.8"></path>
        <path d="M 45,24 27,14 27,34" fill="#fff"></path>
      </svg>
    </button>
    <iframe
      v-if="isPlay"
      width="100%"
      height="100%"
      :src="src"
      frameborder="0"
      allow="autoplay; encrypted-media"
      allowfullscreen></iframe>

  </div>
</template>

<script>
const yembed = 'https://www.youtube.com/embed/'

export default {
  data() {
    return {
      vid: '',
      src: '',
      isPlay: false
    }
  },
  props: {
    url: { type: String, required: true }
  },
  watch: {
    url: {
      immediate: true,
      handler() {
        const [base, query] = this.url.split('?')
        const qParams = query
          ? query
              .split('&')
              .map((q) => q.split('='))
              .reduce((prev, curr) => ({ ...prev, [curr[0]]: curr[1] }), {})
          : {}

        const embParams = {
          autoplay: 1,
          ...(qParams.t && { start: qParams.t })
        }

        const embQuery = Object.keys(embParams)
          .reduce((prev, curr) => [...prev, [curr, embParams[curr]].join('=')], [])
          .join('&')

        this.vid = qParams.v || base.split('/').pop()
        this.src = [`${yembed}${this.vid}`, embQuery].join('?')
      }
    }
  },
  computed: {
    thumb() {
      return `https://i.ytimg.com/vi_webp/${this.vid}/mqdefault.webp`
    },
    thumbStyle() {
      return {
        'background-image': `url(${this.thumb});`
      }
    }
  }
}
</script>

<style lang="scss" scoped>
.ytpContainer {
  cursor: pointer;
  position: relative;
  background: rgba(0, 0, 0, 0.6) no-repeat center center;
  background-size: contain;

  &:hover .ytp-large-play-button-bg {
    transition: fill 0.1s cubic-bezier(0, 0, 0.2, 1), fill-opacity 0.1s cubic-bezier(0, 0, 0.2, 1);
    fill: #f00;
    fill-opacity: 1;
  }
}
.ytp-large-play-button {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 68px;
  height: 48px;
  transform: translate(-50%, -50%);
  transition: opacity 0.25s cubic-bezier(0, 0, 0.2, 1);
  z-index: 63;
}
.ytp-button {
  border: none;
  background-color: transparent;
  padding: 0;
  font-size: 100%;
  cursor: inherit;
  outline: 0;
}
</style>
